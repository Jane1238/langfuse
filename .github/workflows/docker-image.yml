name: Build Custom Langfuse with Subpath

on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘æ„å»º

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: 4b3d7901b87eae2c49adbf43d9269b78f4669c8f

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          file: web/Dockerfile
          push: true
          # ä¿®æ”¹ä¸‹æ–¹çš„ your-dockerhub-username ä¸ºæ‚¨çœŸå®çš„ Docker Hub ç”¨æˆ·å
          tags: ${{ secrets.DOCKER_USERNAME }}/langfuse-custom:3.133.0
          # ğŸš¨ å…³é”®ï¼šåœ¨è¿™é‡Œæ³¨å…¥å­è·¯å¾„å‚æ•° ğŸš¨
          build-args: |
            NEXT_PUBLIC_BASE_PATH=/langfuse_web
            NEXT_PUBLIC_BK_LOGGER_ENABLED=false
